dataSource:
  name: BidsImpressions
  rootPath: s3a://thetradedesk-mlplatform-us-east-1/features/data/koav4/v=1
  prefix: /prod/bidsimpressions/year={year}/month={monthMM}/day={dayDD}/hourPart={hourInt}/
  format: parquet
  loadQuery: |
    SELECT
    UIID as TDID,
    CampaignId,
    AdvertiserId,
    CAST(IsImp AS INT) as WinRate
    FROM datasource

# aggregation levels configuration
aggLevels:
  - level: AdvertiserId
    saltSize: 100
    initAggGrains: [ hour ]
    initWritePartitions: 10
    enableFeatureKeyCount: true
  - level: CampaignId
    saltSize: 100
    initAggGrains: [ hour ]
    initWritePartitions: 10
    enableFeatureKeyCount: true
  - level: TDID
    saltSize: -1
    initAggGrains: [ hour ]
    initWritePartitions: 1500
    rollupWritePartitions: 10000
    enableFeatureKeyCount: true

initAggConfig:
  outputRootPath: "s3a://thetradedesk-mlplatform-us-east-1"
  outputPrefix: /features/feature_store/{ttdEnv}/profiles/source=bidsimpression/index={indexPartition}/job={grain}InitialAggJob/v=1/

rollupAggConfig:
  outputRootPath: "s3a://thetradedesk-mlplatform-us-east-1"
  outputPrefix: /features/feature_store/{ttdEnv}/profiles/source=bidsimpression/index={indexPartition}/job=RollupAggJob/v=1/date={dateStr}/
  windowGrain: day

aggregations:
  - field: WinRate
    dataType: int
    aggWindows: [ 1, 3, 7 ]
    aggFunc: [ Mean ]